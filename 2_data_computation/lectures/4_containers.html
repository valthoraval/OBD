<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

    <title>Containers & Docker</title>
    <link rel="shortcut icon" href="./favicon.ico" />
    <link rel="stylesheet" href="./dist/reveal.css" />
    <link rel="stylesheet" href="./static/css/reset.css" />
    <link rel="stylesheet" href="./static/css/evo.css" />
    <!-- <link rel="stylesheet" href="_assets/evo" id="theme" /> -->
    <link rel="stylesheet" href="./css/highlight/zenburn.css" />

    <link rel="stylesheet" href="./_assets/static/css/evo.css" />
    <link rel="stylesheet" href="./_assets/static/css/reset.css" />

</head>

<body>
    <div class="reveal">
        <div class="slides"><section  data-markdown><script type="text/template">

## From virtualisation to Containerisation

![](static/img/docker_meme.png)

</script></section><section ><section data-markdown><script type="text/template">

### Outline

* **Presentation** (30)
* **Self-paced Workshop** (1h30)
* **QCM/Evaluation** (15 minutes)

To be continued with Orchestration & Deployment

</script></section><section data-markdown><script type="text/template">

#### This class will be successful if you understand

* why we need a tool like docker
* the basics of docker (containers, images) <!-- .element: class="fragment" data-fragment-index="1" -->
* the basics of a container registry <!-- .element: class="fragment" data-fragment-index="2" -->
* how to pull an image and run a container <!-- .element: class="fragment" data-fragment-index="3" -->
* what a `Dockerfile` looks like <!-- .element: class="fragment" data-fragment-index="4" -->

</script></section></section><section ><section data-markdown><script type="text/template">

### The need for Containers in software

![](https://miro.medium.com/max/400/1*qY9Mmc2k_agwALr2UGY-8g.png)

</script></section><section data-markdown><script type="text/template">

#### IT Multimodality

![](https://pointful.github.io/docker-intro/docker-img/the-challenge.png)

</script></section><section data-markdown><script type="text/template">

#### The Matrix From Hell

![](https://pointful.github.io/docker-intro/docker-img/the-matrix-from-hell.png)

</script></section><section data-markdown><script type="text/template">

#### Analogy

![](https://pointful.github.io/docker-intro/docker-img/cargo-transport-pre-1960.png)

</script></section><section data-markdown><script type="text/template">

#### Solution ?

![](https://pointful.github.io/docker-intro/docker-img/intermodal-shipping-container.png)

</script></section><section data-markdown><script type="text/template">

#### Solution !

![](https://pointful.github.io/docker-intro/docker-img/shipping-container-for-code.png)

</script></section></section><section ><section data-markdown><script type="text/template">

![](https://www.docker.com/sites/default/files/social/docker_facebook_share.png)

</script></section><section data-markdown><script type="text/template">

Docker is **a** solution that **standardizes** packaging and execution of software in isolated
 environments
 (**containers**) that share resources and can communicate between themselves

> Build, Share, and Run Any App, Anywhere

</script></section><section data-markdown><script type="text/template">

[Docker](https://www.docker.com/)

* Created in 2013
* Open Source
* Not a new idea but set a new standard
* Docker is a company built around its main product (Docker Engine)
* in charge of dev of everything docker + additional paid services (Docker hub...)

</script></section><section data-markdown><script type="text/template">

Docker is not the only solution for containers

<https://chimeracoder.github.io/docker-without-docker/#30>

<https://podman.io/>

</script></section><section data-markdown><script type="text/template">

Docker is some fancy tech over linux kernel capabilities (containers)

![](https://miro.medium.com/max/700/1*4dxszUyIznfjjzSNgpI0nw.png)

[more info](https://medium.com/@goyalsaurabh66/docker-basics-cb006b9be243)

</script></section><section data-markdown><script type="text/template">

But Docker is available on [Windows and MacOS](https://www.docker.com/products/docker-desktop) !

![desktop](https://www.docker.com/sites/default/files/d8/styles/role_icon/public/2020-01/DesktopAction%402.png?itok=fSjduwO7)

</script></section></section><section ><section data-markdown><script type="text/template">

### Containers or VMs ?

</script></section><section data-markdown><script type="text/template">

#### Drawbacks of VMs

* VM Contains full OS at each install => Install + Resource overhead
* VM needs pre-allocation of resource for each VM (=> Waste if not used)
* Communication between VM <=> Communication between computers

</script></section><section data-markdown><script type="text/template">

#### Container vs Virtual Machine

![](https://www.docker.com/sites/default/files/d8/2018-11/docker-containerized-and-vm-transparent-bg.png)

</script></section><section data-markdown><script type="text/template">

#### Container vs Virtual Machine, an Analogy

![](http://www.lukewilson.net/images/2017/02/apartment-house.png)

</script></section><section data-markdown><script type="text/template">

#### Resources allocation in containers

* Containers share underlying OS / Kernels
* The container engine can allocate resources (CPU, Storage, RAM) on the fly (!= VM)
* GPU is way easier to manage / share with containers

![](static/img/containers_vs_vm.png)

</script></section><section data-markdown><script type="text/template">

#### Some drawbacks of containers

* Containers are based on linux tech  
  (Docker makes Windows container possible though)
* Isolation is not perfect since containers share underlying kernels (security and stability)

</script></section></section><section ><section data-markdown><script type="text/template">

### Enabling "Devops" philosophy

</script></section><section data-markdown><script type="text/template">

![](https://pointful.github.io/docker-intro/docker-img/separation-of-concerns.png)

</script></section><section data-markdown><script type="text/template">

![](https://image.slidesharecdn.com/docker101november2016-161205192653/95/docker-101-nov-2016-13-638.jpg)

</script></section></section><section ><section data-markdown><script type="text/template">

### Containers for Data Science

</script></section><section data-markdown><script type="text/template">

#### Multiple People

![](https://img.pngio.com/viewpoint-how-should-i-structure-my-data-science-team-science-teams-png-700_500.png)

</script></section><section data-markdown><script type="text/template">

#### Complex Workflows

![](https://miro.medium.com/max/1566/1*_EDimQP_2_sen1v3Xf3fpw.jpeg) <!-- .element: height="60%" width="60%" -->

</script></section><section data-markdown><script type="text/template">

#### Data Science is about reproducibility

- Communicating results
- Experimental science
- Hands-out

</script></section><section data-markdown><script type="text/template">

#### So... containers ?

- ... for deployment
- ... for standardized development environments
- ... dependency management
- ... for complex / large scale workflows

**it works on my notebook !**

</script></section><section data-markdown><script type="text/template">

[Netflix and notebook scheduling](https://medium.com/netflix-techblog/scheduling-notebooks-348e6c14cfd6)

<img src="https://miro.medium.com/max/1229/0*byeqo-pBXVPU6xjq" alt="" style="width: 60%; height: 60%; background:none; border:none; box-shadow:none;"/>

</script></section><section data-markdown><script type="text/template">

https://www.kubeflow.org/
![](https://miro.medium.com/max/2446/1*ZQsFV3o1c3Amu26Z-IEd7w.png)

</script></section></section><section ><section data-markdown><script type="text/template">

### Using Docker in practice

![](static/img/docker-jworkflow.jpg)


</script></section><section data-markdown><script type="text/template">

#### Vocabulary of Docker

- **Layer**: Set of read-only files to provision the system
- **Image**: Read-Only layer "snapshot" of an environment. Can inherit from another **Image**
- **Container**: Read-Write instance of an **Image**
- **DockerFile**: Description of the process used to build an Image
- **Hub**: Repository of Docker Images

</script></section><section data-markdown><script type="text/template">

![](https://pointful.github.io/docker-intro/docker-img/basics-of-docker-system.png)

</script></section><section data-markdown><script type="text/template">

#### Layers, Container, Image

![](https://nvisium.com/articles/2014/2014-10-15-docker-cache-friend-or-foe/docker-filesystems-multilayer.png)

</script></section><section data-markdown><script type="text/template">

#### Image vs Container

Docker:
```Dockerfile
FROM python:3.6
RUN pip install torch
CMD ipython
```

```bash
docker build -f Dockerfile -t my-image:1.0 .
docker run my-image
```

Python:
```python
class BaseImage:
    def __init__(self, a):
       self.a = a

class NewImage(BaseImage):
    def __init__(self, a, b):
       super(NewImage, self).__init__(a=a)
       self.b = b

container = NewImage(a=0,b=1)
```

</script></section><section data-markdown><script type="text/template">

#### Dockerfile

```Dockerfile
FROM python:3.7
ENV MYVAR="HELLO"
RUN pip install torch
COPY my-conf.txt /app/my-conf.txt
ADD my-file.txt /app/my-file.txt
EXPOSE 9000
WORKDIR "/WORKDIR"
USER MYUSER
ENTRYPOINT ["/BIN/BASH"]
CMD ["ECHO” , "${MYVAR}"] 
```

```bash
docker build -f Dockerfile -t my-image:1.0 .
docker run my-image
```

- Reproducible (if you include static data)
- Can be put under version control (simple text file)

</script></section><section data-markdown><script type="text/template">

#### Architecture

![](https://docs.docker.com/engine/images/architecture.svg)

</script></section><section data-markdown><script type="text/template">

#### Registry

- Local registry: All images/containers in your machine
- https://hub.docker.com/
- GCP Container Registry
- Social Dimension (share docker images to speed up development/deployment)

</script></section><section data-markdown><script type="text/template">

#### In practice

<img src="static/img/docker_pratique.png" alt="" style="width: 50%; height: 50%; background:none; border:none; box-shadow:none;"/>

</script></section><section data-markdown><script type="text/template">

#### REMEMBER THIS !!!

![](static/img/docker-jworkflow.jpg)

</script></section></section><section ><section data-markdown><script type="text/template">

### A bit about the ecosystem

</script></section><section data-markdown><script type="text/template">

#### Docker Compose

- Multi-containers application with networking

![](https://code.scottshipp.com/wp-content/uploads/2019/06/docker-compose-logo.png)

</script></section><section data-markdown><script type="text/template">

#### Docker Compose

```yaml
version: '3'

services:
  app:
    build: .
    image: takacsmark/flask-redis:1.0
    environment:
      - FLASK_ENV=development
    ports:
      - 5000:5000

  redis:
    image: redis:4.0.11-alpine
```

</script></section><section data-markdown><script type="text/template">

... and so many more !

![](https://img1.daumcdn.net/thumb/R800x0/?scode=mtistory2&fname=https%3A%2F%2Ft1.daumcdn.net%2Fcfile%2Ftistory%2F996C7D4B5AF43B6C27)

</script></section></section><section ><section data-markdown><script type="text/template">

### Docker and GCP

</script></section><section data-markdown><script type="text/template">

#### GCP & Docker

- The per-project dockerhub is called [Container Registry](https://cloud.google.com/container-registry/) 
- Your images look like this `eu.gcr.io/project-id/a/b/c:1.0`
- You can use [Google Cloud Build](https://cloud.google.com/cloud-build/) to build dockerfiles remotely `gcloud builds submit --tag gcr.io/[PROJECT_ID]/quickstart-image .`
- To use gcloud with docker: `gcloud auth configure-docker`

</script></section><section data-markdown><script type="text/template">

#### GCP & Docker

- Everything is container-based (virtualization...)
- You can even deploy "virtual machines" with containers directly

... Where's the boundary ?

</script></section></section><section ><section data-markdown><script type="text/template">

### Self-Paced Workshop

</script></section><section data-markdown><script type="text/template">

#### Demo time

</script></section><section data-markdown><script type="text/template">

#### play-with-docker

- You need to have a docker hub account : https://hub.docker.com/
- https://labs.play-with-docker.com/
- Free, interactive, cluster of vms to experiment docker with
- https://training.play-with-docker.com/ lots of resoures !

</script></section><section data-markdown><script type="text/template">

[Go here](https://github.com/fchouteau/isae-practical-gcp/tree/master/2-docker)

[If you have finished go here](https://github.com/fchouteau/isae-practical-gcp/tree/master/3-deploy-model-into-production)

</script></section></section><section ><section data-markdown><script type="text/template">

### Cheatsheets

</script></section><section data-markdown><script type="text/template">

![](https://jrebel.com/wp-content/uploads/2016/03/Docker-cheat-sheet-by-RebelLabs.png)

</script></section><section data-markdown><script type="text/template">

#### Dockerfile : Description d'une image

```Dockerfile
FROM python:3.7
ENV MYVAR="HELLO"
RUN pip install torch
COPY my-conf.txt /app/my-conf.txt
ADD my-file.txt /app/my-file.txt
EXPOSE 9000
WORKDIR "/WORKDIR"
USER MYUSER
ENTRYPOINT ["/BIN/BASH"]
CMD ["ECHO” , "${MYVAR}"]
```

```bash
docker build -f Dockerfile -t my-image:1.0 .
docker run my-image
```

</script></section><section data-markdown><script type="text/template">

#### Images

    "docker search" sur un registry
        public (DokerHub)
        privé (entreprise)
    "docker build" à partir d'un Dockerfile
    "docker commit" sur un conteneur modifié
    "docker import" d'une arbo de base :
    
    cat centos6-base.tar | docker import - centos6-base

</script></section><section data-markdown><script type="text/template">

#### Docker CLI

    docker create   : crée un conteneur
    docker run      : crée et démarre un conteneur
    docker stop     : arrête un conteneur
    docker start    : démarre un conteneur
    docker restart  : redémarre un conteneur
    docker rm       : supprime un conteneur
    docker kill     : envoie un SIGKILL au conteneur
    docker attach   : se connecte à un conteneur en exécution 
    docker exec     : exécute une cmd dans un conteneur

</script></section><section data-markdown><script type="text/template">

#### Docker run

    -d, --detach       Run container in background and print ID
    -e, --env=[]       Set environment variables
    -i, --interactive  Keep STDIN open even if not attached
    -p, --publish=[]   Publish a container's port(s) to the host
    --rm               Automatically rm container when it exits
    -t, --tty          Allocate a pseudo-TTY
    -v, --volume=[]    Bind mount a volume
    -w, --workdir      Working directory inside the container
</script></section></section></div>
    </div>
    <!-- <div id="footer-container" style="display:none;"> -->
    <div id="footer-container">
        <div id="footer">
            OBD Data Computation #1 - October 2020
            <br />
            <a href="https://supaerodatascience.github.io/OBD/">https://supaerodatascience.github.io/OBD/</a>
            <br />
            <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License"
                    style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png" /></a>
        </div>
    </div>
    <div id="logo-container">
        <div id="logo">
            <img src="static/img/sdd_logo.png" width="8%">
        </div>
    </div>
    <script src="./dist/reveal.js"></script>

    <script src="./plugin/markdown/markdown.js"></script>
    <script src="./plugin/highlight/highlight.js"></script>
    <script src="./plugin/zoom/zoom.js"></script>
    <script src="./plugin/notes/notes.js"></script>
    <script src="./plugin/math/math.js"></script>
    <script>
        function extend() {
            var target = {};
            for (var i = 0; i < arguments.length; i++) {
                var source = arguments[i];
                for (var key in source) {
                    if (source.hasOwnProperty(key)) {
                        target[key] = source[key];
                    }
                }
            }
            return target;
        }

        // default options to init reveal.js
        var defaultOptions = {
            controls: true,
            progress: true,
            history: true,
            center: true,
            transition: 'default', // none/fade/slide/convex/concave/zoom
            plugins: [
                RevealMarkdown,
                RevealHighlight,
                RevealZoom,
                RevealNotes,
                RevealMath
            ]
        };

        // options from URL query string
        var queryOptions = Reveal().getQueryHash() || {};

        var options = extend(defaultOptions, {"transition":"fade","transitionSpeed":"default","controls":true,"slideNumber":true,"width":"100%","height":"100%"}, queryOptions);
    </script>


    <script>
        Reveal.initialize(options);
        var footer = $('#footer-container').html();
        $('div.reveal').append(footer);
        var logo = $('#logo-container').html();
        $('div.reveal').append(logo);
    </script>
</body>

</html>